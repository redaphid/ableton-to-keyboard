<script src="node_modules/push-wrapper/dist/umd/push-wrapper.js"></script>
<script>
    navigator.requestMIDIAccess({ sysex: true }).then((midiAccess) => {
        const push = pushWrapper.push()
        
        // bind to first available MIDI output
        // const output = midiAccess.outputs.values()[0].value
        // push.onMidiToHardware(output.send.bind(output))

        // bind to first available MIDI input
        const inputs =  midiAccess.inputs.values()
        for(let input of inputs) {
            if(!input.manufacturer) continue //might be midi loopback
            input.onmidimessage = (event) =>{
                if(!event.data) return //I guess this happens sometimes?
                push.midiFromHardware(event.data)                
                push.gridRow(0)[0].ledRGB(255,255,255)
            } 
            
        }

        const outputs =  midiAccess.outputs.values()
        for(let output of outputs) {
            if(!output.manufacturer) continue //might be midi loopback
            push.onMidiToHardware(output.send.bind(output))            

        }


    })
</script>